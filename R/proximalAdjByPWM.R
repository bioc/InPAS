#' adjust the proximal CP sites by PWM
#' 
#' adjust the proximal CP sites by polyA Position Weight Matrix. 
#' It only need the PWM get match in upstream or downstream 
#' shift_range nr.
#'
#' @param idx  the offset of positions of CP sites
#' @param PolyA_PWM polyA PWM
#' @param seqnames sequence names
#' @param starts start position in the genome
#' @param strands strands
#' @param genome an [BSgenome::BSgenome-class] object
#' @param shift_range  the shift range of PWM hits
#' @param search_point_START  Not use
#'
#' @return the offset of positions of CP sites after filter
#' @details the hits is searched by [Biostrings::matchPWM()] and the 
#' cutoff is 70\%
#' @seealso [proximalAdjByCleanUpdTSeq()], [PAscore()]
#' @keywords internal
#'

proximalAdjByPWM <- function(idx, PolyA_PWM, seqnames, starts, strands,
                             genome, shift_range, search_point_START){
    mapply(function(id, seqname, start, strand){
        if(length(id)==1){
            if(is.na(id)){
                return(NULL)
            }
        }
        if(length(id)>0){
            pos <- if(strand=="+") start + id - 1 else start - id + 1
            id <- PAscore(seqname, pos, strand, 
                          id, PWM=PolyA_PWM, genome=genome,
                          ups=shift_range+25,
                          dws=shift_range+25)
        }
        id
    }, idx, seqnames, starts, strands, SIMPLIFY=FALSE)
}